---
import StatusBadge from './StatusBadge.astro';
import type { Database } from '../../types/supabase';

type Motorhome = Database['public']['Tables']['motorhomes']['Row'];
interface Props {
    motorhomes: Motorhome[];
}
const { motorhomes } = Astro.props;
---
<div class="bg-background-light dark:bg-background-dark rounded-lg border border-primary/20 dark:border-primary/30 overflow-x-auto">
    <table class="w-full text-left">
        <thead class="border-b border-primary/20 dark:border-primary/30">
            <tr>
                <th class="p-4 text-sm font-bold text-background-dark dark:text-background-light/70 uppercase tracking-wider">Imagen</th>
                <th class="p-4 text-sm font-bold text-background-dark dark:text-background-light/70 uppercase tracking-wider">Nombre</th>
                <th class="p-4 text-sm font-bold text-background-dark dark:text-background-light/70 uppercase tracking-wider">Modelo</th>
                <th class="p-4 text-sm font-bold text-background-dark dark:text-background-light/70 uppercase tracking-wider">Precio</th>
                <th class="p-4 text-sm font-bold text-background-dark dark:text-background-light/70 uppercase tracking-wider">Estado</th>
                <th class="p-4 text-sm font-bold text-background-dark dark:text-background-light/70 uppercase tracking-wider text-right">Acciones</th>
            </tr>
        </thead>
        <tbody class="divide-y divide-primary/10 dark:divide-primary/20">
            {motorhomes.map(item => (
                <tr class="hover:bg-primary/5 dark:hover:bg-primary/10">
                    <td class="p-4">
                        <div class="w-12 h-12 rounded-lg bg-cover bg-center" style={`background-image: url("${item.image}");`}></div>
                    </td>
                    <td class="p-4 text-sm font-medium text-background-dark dark:text-background-light">{item.title}</td>
                    <td class="p-4 text-sm text-background-dark/70 dark:text-background-light/70">{item.short_description}</td>
                    <td class="p-4 text-sm text-background-dark/70 dark:text-background-light/70">{item.price}</td>
                    <td class="p-4">
                        <StatusBadge status={item.status as any} />
                    </td>
                    <td class="p-4 text-right">
                        <a href={`/admin/motorhome/${item.id}`} class="p-2 ...">
                            <span class="material-symbols-outlined">edit</span>
                        </a>
                        <button data-delete-id={item.id} class="p-2 ...">
                            <span class="material-symbols-outlined">delete</span>
                        </button>
                    </td>
                </tr>
            ))}
        </tbody>
    </table>
</div>

<script>
    import { supabase } from '../../lib/supabase';

    const deleteButtons = document.querySelectorAll('[data-delete-id]');

    deleteButtons.forEach(button => {
        button.addEventListener('click', async () => {
            const motorhomeId = button.getAttribute('data-delete-id');

            const confirmed = window.confirm('¿Estás seguro de que querés eliminar este motorhome? Esta acción no se puede deshacer.');

            if (confirmed && motorhomeId) {
                const { error } = await supabase
                    .from('motorhomes')
                    .delete()
                    .eq('id', motorhomeId);

                if (error) {
                    alert(`Error al eliminar: ${error.message}`);
                } else {

                    alert('Motorhome eliminado con éxito.');
                    window.location.reload();
                }
            }
        });
    });
</script>